### 9.3 回歸模型的評估與診斷

回歸模型的評估與診斷是檢驗模型是否適合數據、是否能提供可靠預測的重要步驟。回歸分析不僅僅是擬合一條回歸直線，還包括對模型假設的檢驗、殘差分析、以及評估模型的預測能力和解釋能力。以下是回歸模型評估與診斷的幾個關鍵步驟。

#### 9.3.1 決定係數（ $`R^2`$ ）

決定係數  $`R^2`$  是評估回歸模型擬合度的常用指標。它衡量了模型解釋因變數變異的比例。 $`R^2`$  的範圍是從 0 到 1，值越大表示模型的擬合度越高。計算公式如下：

```math
R^2 = 1 - \frac{\sum_{i=1}^n (y_i - \hat{y}_i)^2}{\sum_{i=1}^n (y_i - \bar{y})^2}
```

其中， $`y_i`$  是實際值， $`\hat{y}_i`$  是預測值， $`\bar{y}`$  是因變數的樣本均值。若  $`R^2`$  趨近於 1，表示模型能解釋大部分因變數的變異。

然而， $`R^2`$  並不總是最好的指標，特別是當模型中有多個自變數時，可能會出現過度擬合的情況。因此，需要使用**調整後的  $`R^2`$ **，它考慮了自變數的數量，避免過度擬合：

```math
\text{Adjusted } R^2 = 1 - \left(\frac{n - 1}{n - p - 1}\right) \left(1 - R^2\right)
```

其中， $`n`$  是樣本大小， $`p`$  是自變數的數量。

#### 9.3.2 殘差分析

殘差分析是回歸診斷中最重要的部分，通過分析殘差可以檢查回歸模型的假設是否成立。殘差是觀察值與預測值之間的差異，計算公式為：

```math
e_i = y_i - \hat{y}_i
```

殘差分析的主要目標是檢驗以下幾個假設：
1. **隨機性**：殘差應該是隨機分佈的，即不應該顯示出任何系統性的模式。可以繪製殘差圖來檢查殘差是否隨著預測值的變化而系統性地排列，若出現明顯的模式（如圓形、曲線等），可能表示模型擬合不當。
2. **常態性**：殘差應當服從正態分佈，這是進行假設檢定的基本假設之一。可以使用Q-Q圖（Quantile-Quantile plot）來檢查殘差的分佈是否接近正態分佈，或使用Shapiro-Wilk檢定進行統計檢驗。
3. **異方差性（Heteroscedasticity）**：殘差的變異應該是穩定的，即隨著預測值的增大或減小，殘差的變異應該保持一致。異方差性可以通過繪製殘差與預測值的散點圖來檢測。如果圖中顯示出隨著預測值變大或變小，殘差的變異性也有所變化，則可能存在異方差性。

如果發現異方差性，可以通過對數變換或加權最小二乘法來修正。

#### 9.3.3 檢查多重共線性

多重共線性指的是自變數之間存在高度線性關係，這會導致回歸係數估計的不穩定，使得結果不可靠。常見的檢測多重共線性的方法是計算**方差膨脹因子（VIF, Variance Inflation Factor）**。方差膨脹因子的定義為：

```math
VIF_j = \frac{1}{1 - R_j^2}
```

其中， $`R_j^2`$  是將第  $`j`$  個自變數回歸於其餘自變數所得到的決定係數。如果  $`VIF_j`$  的值大於 10，則表明該變數與其他變數存在較強的線性關係，可能需要進行變數選擇或降維處理。

#### 9.3.4 標準誤差與t檢定

標準誤差是回歸係數估計的變異程度。對每個回歸係數  $`\hat{\beta_j}`$ ，其標準誤差  $`SE(\hat{\beta_j})`$  是衡量該估計值不確定性的指標。對於每個回歸係數，t 檢定統計量用來檢查該變數是否顯著影響因變數，計算公式為：

```math
t_j = \frac{\hat{\beta_j}}{SE(\hat{\beta_j})}
```

t 統計量的自由度為  $`n - p - 1`$ ，通過查 t 分布表來檢驗零假設  $`H_0: \beta_j = 0`$ ，即該變數對因變數的影響不顯著。

#### 9.3.5 預測區間與置信區間

- **預測區間**：對新觀察值的預測，考慮了模型誤差的影響。預測區間可以給出預測值的範圍，並且具有一定的置信度。
- **置信區間**：對回歸係數的估計，給出其可能範圍。通過置信區間，我們可以了解回歸係數的真實值可能落在的範圍，這對模型的解釋性至關重要。

#### 9.3.6 模型選擇與正則化

在多元回歸模型中，過多的自變數可能會導致過度擬合，對訓練數據的擬合過於精確，但對測試數據的預測能力較弱。為了解決這個問題，可以使用模型選擇方法，如**逐步回歸**（Stepwise Regression）、**正則化**方法，如**Lasso 回歸**（L1 正則化）和**Ridge 回歸**（L2 正則化），來選擇最有影響的變數並減少過擬合。

#### 9.3.7 小結

回歸模型的評估與診斷是確保模型有效性和可靠性的重要步驟。通過分析決定係數、殘差、檢查多重共線性和t檢定等方法，我們可以確保模型符合假設並適合用於預測。進一步的診斷和模型選擇能夠幫助提高回歸模型的解釋力與預測能力。