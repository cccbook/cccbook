#### 6.2 去噪擴散概率模型 (DDPM)

去噪擴散概率模型（Denoising Diffusion Probabilistic Models，簡稱DDPM）是一種基於擴散過程的生成模型，其目標是從隨機噪聲中生成高質量的數據，並且提供了一種穩定且有效的生成過程。DDPM 是擴散模型的典型代表，並且在影像生成領域取得了顯著的成效。該模型的關鍵思想是將圖像的生成過程看作是一個逐步去噪的過程，即從純噪聲開始，逐步去除噪聲，直到恢復出原始的數據。

##### 6.2.1 DDPM 的核心思想
DDPM 依賴於兩個主要過程：**前向過程（forward process）** 和 **反向過程（reverse process）**。

- **前向過程**：這是加噪過程，將原始數據 \( x_0 \) 逐步加入噪聲，直到它變得幾乎完全是隨機噪聲。在每一個時間步 \( t \)，數據樣本 \( x_0 \) 會經過一個高斯噪聲過程，逐步變得模糊。數學上，前向過程是基於隨機過程模型來建模的，其中每個時間步的數據都是從前一時間步加上某種噪聲分佈所得到的：
  \[
  q(x_t | x_{t-1}) = \mathcal{N}(x_t; \sqrt{1-\beta_t}x_{t-1}, \beta_t \mathbf{I}),
  \]
  其中 \( \beta_t \) 是控制每個時間步噪聲的增強程度的變數，並且隨著時間步的增加，噪聲逐漸增強。

- **反向過程**：反向過程是去噪過程，目的是從最終的噪聲 \( x_T \) 中逐步重建出原始數據 \( x_0 \)。這一過程使用神經網絡來學習每個時間步的反向噪聲過程。反向過程的目標是學習 \( p_\theta(x_{t-1} | x_t) \) 的條件分佈，使得生成的樣本越來越接近原始數據：
  \[
  p_\theta(x_{t-1} | x_t) = \mathcal{N}(x_{t-1}; \mu_\theta(x_t, t), \sigma_t^2 \mathbf{I}),
  \]
  其中 \( \mu_\theta(x_t, t) \) 是反向過程中的預測均值，\( \sigma_t^2 \) 是根據時間步 \( t \) 設定的噪聲方差。

##### 6.2.2 損失函數和訓練目標
DDPM 的訓練過程的核心目標是最小化生成圖像過程中的去噪誤差。具體來說，DDPM 使用以下損失函數來進行訓練：
\[
\mathcal{L}_{\text{DDPM}} = \mathbb{E}_{q(x_1, \dots, x_T | x_0)} \left[ \| \epsilon_\theta(x_t, t) - \epsilon \|^2 \right],
\]
其中 \( \epsilon_\theta(x_t, t) \) 是神經網絡對當前時間步 \( t \) 和樣本 \( x_t \) 的噪聲預測，\( \epsilon \) 是真實的噪聲。這個損失函數目的是讓模型學會如何準確地預測噪聲，從而在反向過程中能夠更有效地去除噪聲，生成真實的數據。

DDPM 的關鍵挑戰在於如何處理隨時間增強的噪聲，並有效地學習每個時間步的去噪操作。由於每個時間步的噪聲會影響最終生成結果，因此反向過程需要在不同的時間步之間進行精細的調整。

##### 6.2.3 神經網絡的使用
在 DDPM 中，神經網絡通常用來近似反向過程中的噪聲預測函數 \( \epsilon_\theta(x_t, t) \)。這些神經網絡需要處理來自不同時間步的不同程度的噪聲，並學會如何去除這些噪聲。為了加速訓練過程並提高模型的表現，DDPM 中的神經網絡通常採用 U-Net 這樣具有跳躍連接的架構，這樣可以保留圖像的結構信息，有助於更好地重建圖像。

##### 6.2.4 去噪擴散模型的優勢
DDPM 在影像生成方面表現出了顯著的優勢，尤其是在生成質量、穩定性以及細節重建方面：

- **穩定性**：與生成對抗網絡（GAN）相比，DDPM 的訓練過程更加穩定。GAN 在訓練過程中可能會遭遇模式崩潰（mode collapse）等問題，而 DDPM 通過去噪過程逐步生成圖像，避免了這些問題。
  
- **高質量生成**：DDPM 可以生成非常高質量的圖像，並且在各種生成任務（如影像生成、超解析度重建等）中表現出色。

- **可控性**：由於反向過程的可學習性，DDPM 允許對生成過程進行精細的控制，例如調整生成圖像的噪聲水平，進而影響最終生成的結果。

##### 6.2.5 DDPM的挑戰
儘管DDPM具有許多優勢，但其在實際應用中仍面臨一些挑戰：

- **訓練時間長**：DDPM 的生成過程需要經過多個時間步，每一步都需要計算並去噪，因此訓練和推理的時間相對較長，對計算資源的需求較高。

- **生成過程的計算成本**：由於每次生成都需要多次迭代去噪，因此DDPM 的生成過程需要較長的計算時間，這使得它在實時應用中的效率較低。

##### 6.2.6 小結
去噪擴散概率模型（DDPM）通過將影像生成過程視為逐步去噪的過程，提供了一種穩定且高效的生成框架。其訓練過程的關鍵在於學習如何從噪聲中恢復出高質量的數據。儘管 DDPM 在生成質量和穩定性方面表現優異，但其較長的訓練和推理時間使其在某些實際應用中仍面臨挑戰。