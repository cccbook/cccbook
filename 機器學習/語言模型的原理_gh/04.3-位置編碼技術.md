### **位置編碼技術**

在處理序列數據時，捕捉序列中元素的順序信息是至關重要的，特別是在語言模型中，單詞的順序對句子的語法結構和語義理解有著重要影響。然而，Transformer 架構本身並不具備循環結構或卷積結構來捕捉序列順序。為了解決這一問題，Transformer 引入了**位置編碼（Positional Encoding）**技術，讓模型能夠感知序列中各個詞的相對位置。

#### **位置編碼的基本概念**

在 Transformer 模型中，所有的輸入詞向量（詞嵌入）是通過加上位置編碼來獲得的。這樣，詞向量就不僅包含語義信息，還包含了它們在序列中的位置信息。位置編碼向量是一組附加到每個詞嵌入上的向量，這些向量可以讓模型在處理序列時理解單詞的順序。

位置編碼的主要挑戰是如何設計一種方法，使得模型能夠區分序列中各個詞的不同位置，同時又能夠平衡計算效率和靈活性。

#### **1. 位置編碼的數學形式**

最早的 Transformer 使用了一種基於正弦和餘弦函數的**絕對位置編碼**。這一方法的特點是使用不同頻率的正弦和餘弦函數來表示位置，使得每個位置的編碼具有獨特性，且具有較好的平移不變性。

對於給定的序列中第  $`i`$  個位置（位置從 0 開始編號），該位置的編碼向量的計算方式如下：

- 對於編碼向量的第  $`2j`$  維，使用正弦函數：

  
```math
PE_{i, 2j} = \sin\left(\frac{i}{10000^{2j/d}}\right)
```


- 對於編碼向量的第  $`2j+1`$  維，使用餘弦函數：

  
```math
PE_{i, 2j+1} = \cos\left(\frac{i}{10000^{2j/d}}\right)
```


其中：
-  $`i`$  是位置索引，表示序列中單詞的位置（從 0 開始）。
-  $`d`$  是位置編碼向量的維度。
-  $`j`$  是位置編碼向量的維度索引。

這樣計算出來的編碼向量  $`PE_i`$  是一個與位置  $`i`$  相關的向量，每個維度都包含了對應位置的數值。這些正弦和餘弦函數的設計確保了每個位置有獨特的編碼，同時，這些編碼之間的差異是基於位置差異的，這使得 Transformer 能夠感知序列中的位置關係。

#### **2. 為何選擇正弦和餘弦函數**

選擇正弦和餘弦函數有以下幾個理由：

- **不同頻率的變化**：通過使用不同頻率的正弦和餘弦函數，位置編碼能夠在不同的尺度上表達位置差異。例如，低頻正弦和餘弦可以捕捉長距離依賴，而高頻則能捕捉短距離依賴。
- **平滑的順序表示**：由於正弦和餘弦函數是平滑且連續的，這使得模型可以自然地理解相鄰位置之間的相似性，例如，序列中兩個相鄰單詞的編碼差異不會太大。
- **周期性和可擴展性**：正弦和餘弦函數的周期性質意味著位置編碼是有限的，並且對於超過預設範圍的序列，模型仍然可以有效處理，這使得模型具有很好的可擴展性。

#### **3. 位置編碼與詞嵌入的組合**

在 Transformer 模型中，位置編碼會與詞嵌入向量逐元素相加。具體而言，給定輸入的詞嵌入向量  $`E_i`$  和位置編碼向量  $`PE_i`$ ，則序列中每個位置的輸入向量將是兩者之和：


```math
Z_i = E_i + PE_i
```


這樣，詞嵌入向量就不僅包含該詞的語義信息，還包含了該詞在序列中的位置信息。這使得模型能夠在訓練過程中學會利用順序信息來加強對語言結構的理解。

#### **4. 相對位置編碼（相對位置資訊）**

儘管絕對位置編碼對大多數應用有效，但對於一些需要強調相對位置關係的任務（例如機器翻譯），相對位置編碼（Relative Positional Encoding）可能會更有效。在這種方法中，位置編碼的目標是捕捉單詞間的相對距離，而非它們的絕對位置。

相對位置編碼的思想是，對於每一對詞，我們不僅考慮它們在序列中的位置，還要考慮它們之間的相對距離。例如，對於某個詞與另一個詞的關係，會將它們之間的相對位置（如距離、順序等）作為附加信息傳遞。

#### **5. 小結**

位置編碼是 Transformer 模型的核心組成部分之一，它使得模型能夠處理序列數據並理解其中的順序信息。正弦和餘弦函數提供了一種簡單而有效的方式來編碼位置，並且位置編碼與詞嵌入的結合為模型提供了豐富的語言上下文信息。隨著相對位置編碼等方法的發展，位置編碼技術在不同的自然語言處理任務中發揮著關鍵作用。